<div class="card">
    <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
            <h1 class="h4 fw-bold mb-0">
                <i class="bi bi-list-check me-2"></i>My Tasks
            </h1>
        </div>
        <form action="/todos" method="post" class="mb-4 pb-4 border-bottom">
            <div class="mb-3">
                <input type="text" name="title" placeholder="What needs to be done?" class="form-control" required>
            </div>
            <div class="mb-3">
                <textarea name="description" class="form-control" placeholder="Add a description (optional)" rows="2"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-plus-lg me-1"></i>Add Task
            </button>
        </form>
        <div class="todo-list">
            {{#each todos}}
                {{> todo-item title=this.title description=this.description}}
            {{else}}
                <div class="text-center py-5 text-muted">
                    <i class="bi bi-clipboard-check display-4 d-block mb-3 opacity-50"></i>
                    <p class="mb-1">No tasks yet</p>
                    <small>Add your first task above to get started</small>
                </div>
            {{/each}}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const todoList = document.querySelector('.todo-list');
        if(todoList && todoList.children.length > 0) {
            new Sortable(todoList, {
                handle: '.drag-handle',
                animation: 150,
                ghostClass: 'bg-light',
                onEnd: () => {
                    const orderIds = Array.from(todoList.children).map(item => item.dataset.id);

                    fetch('/todos/reorder', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ orderIds })
                    })
                }
            })
        }
    });
</script>